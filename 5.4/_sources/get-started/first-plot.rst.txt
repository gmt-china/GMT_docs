绘制第一张图
============

这一节将通过绘制一张地震学常见的射线路径分布图，来展示GMT模块化作图的思想以及
GMT中图层的概念。

.. important::

   请注意，以下均采用Linux下的bash脚本作为示例，如果你是在
   Windows下使用bat脚本，并且对bash和bat脚本的区别不太了解，
   强烈建议先阅读 :doc:`/appendix/cmd/index` 一节。

图件分析与拆解
--------------

一个完整的图件通常是由很多部分组成的。GMT在制图时遵循模块化思想，
每个模块只绘制整张图的一部分，因而通常一张图需要使用多个GMT命令才能绘制完成。
绘制的过程中，若想修改图中的某个部分，只需修改绘制该部分所使用的命令即可，
而不会影响其他部分。这就是模块化作图。

下图展示了我们最终想要实现的绘图效果。整张图由如下几个部分构成：

#. 底图（海岸线）
#. 震中位置（五角星）
#. 台站位置（三角形）、射线路径（大圆弧线段）
#. 台站名（文本）

.. gmtplot:: first-plot-5.sh
    :show-code: false

下面会一步步地把整张图绘制出来。

绘制底图
--------

GMT中的 :doc:`/module/pscoast` 模块，可以绘制带海岸线的底图，并可以给陆地和海洋分别填充
不同的颜色，绘图命令及效果如下：

.. gmtplot:: first-plot-1.sh

解释一下几个选项：

#. ``-JH110/24c`` 表示使用Hammer投影，投影中心为110度，整张图宽度为 24 厘米
#. ``-Rg`` 相当于 ``-R0/360/-90/90`` 即绘制全球范围
#. ``-Bg30`` 表示网格线每30度显示一条
#. ``-Glightgreen`` 表示将陆地填充浅绿色，\ ``-Slightblue`` 表示将海洋填充浅蓝色

至此，即得到了我们需要的底图。

绘制震中和台站位置
------------------

:doc:`/module/psxy` 模块可以用于绘制多种不同类型的符号，比如五角星和三角形。绘图脚本如下：

.. gmtplot:: first-plot-2.sh

这里我们通过两次调用 ``psxy`` 命令分别绘制了五角星和三角形。
由于绘图的命令比较多，所以我们将绘图命令写成了一个脚本，并定义了一些变量
（比如 ``$PS``\ ）以避免重复输入类似的文本。

解释一下：

#. 第一个 ``psxy`` 命令用于绘制震中位置，第二个则用于绘制台站位置
#. ``-Sa0.5c`` 表示绘制大小为 0.5厘米的五角星，
   ``-St0.2c`` 表示绘制大小为0.2厘米的三角形
#. ``-W`` 表示画笔的属性，这里用于指定用什么样的画笔绘制三角形或五角星的轮廓。
   ``-W0.5p,black,solid`` 的意思是画笔 ``0.5p`` 宽，黑色，实心。
#. ``-G`` 表示颜色填充，后面跟颜色的名字；\ ``-Gblack`` 表示填充黑色；
   ``-Gyellow`` 表示填充黄色。
#. 确定了画什么样的符号，还要确定在哪里画。两个 ``EOF`` 之间的是命令的输入数据，
   在这里就是位置信息，一行代表一个位置。默认情况下，GMT认为第一个数是经度，第二个是纬度。
#. 最后一个 ``psxy`` 命令没有绘制任何东西，其作用在于结束绘图，这属于稍高级的技巧，
   以后会介绍到。

注意到了吗？相对于上一步的命令而言，\ ``pscoast`` 命令中多了一个 ``-K`` 选项，
中间的几个 ``psxy`` 命令使用了 ``-K -O`` 选项，最后一个命令则使用了 ``-O`` 选项。
具体原因此处不解释，在 :doc:`/option/KO` 一节会详细介绍。

绘制射线路径
------------

``psxy`` 模块还可以用于绘制线段，默认情况下，``psxy`` 会自动用大圆路径连接地球上的
两个位置，不需要额外设置。首先直接看代码：

.. gmtplot:: first-plot-3.sh

用于绘制射线路径的 ``psxy`` 命令和之前的命令的区别在于没有了 ``-S`` 和 ``-G`` 选项。
为了绘制一条线段，至少需要指定两个端点，输入数据中每个 ``>`` 之后的两行数据分别
代表一条线条的两个端点位置。

添加台站名
----------

最后还需要往图画里添加台站所在地区的名字。添加文字使用 :doc:`/module/pstext` 模块：

.. gmtplot:: first-plot-4.sh

解释如下：

#. ``EOF`` 之间的每一行依次是加入的文本的纬度、经度和内容，这与 ``psxy`` 类似，
   只是因为有内容，所以多了一列。之所以没有写在一个 ``gmt pstext`` 命令之下，
   是因为不同位置的文本的具体位置需要些许不同的调整，你可以看到每个 ``pstext``
   命令的 ``-D`` 参数些许不同，下面会详细解释。
#. ``-F`` 控制文本的字体、对齐方式等属性； ``+f10p,1,black`` 表示使用大小为
   ``10p`` 的黑色1号字体； ``+j`` 是控制文本的对齐方式，\ ``TL`` 表示输入数据
   中的经纬度坐标是文本块的左上角，\ ``L`` 指左，\ ``T`` 指上，\ ``LT`` 和 ``TL``
   的含义完全一样。
#. ``-D`` 是在上述坐标的基础上微调。\ ``-D-1.5c/-0.15c`` 是说向左移动1.5厘米，
   向下移动0.15厘米。

图层的先后顺序
--------------

上面的绘图脚本已经基本绘制出我们最初想要的图件了。细细看会发现，还有一些不完美的
地方：比如黄色五角星和三角形被线段盖住了。

这是因为，GMT的每一个绘图命令都会产生一个图层，后绘制的图层会覆盖在先绘制的图层
的上面，即后来者居上。解决办法也很简单，先绘制线段，再绘制三角形和五角星即可。

对脚本中命令的先后顺序进行微调，如下所示：

.. gmtplot:: first-plot-5.sh

需要注意的是，本节内容仅作演示用，实际绘图时通常会写脚本来处理自己的数据，
以使得其符合GMT输入数据的要求，而不是像本节示例中这样手写所有的数据。
