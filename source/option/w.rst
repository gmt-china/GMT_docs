-w 选项
=======

**-w** 选项用于将输入坐标转换为循环坐标，其语法为：

    **-wy**\|\ **a**\|\ **w**\|\ **d**\|\ **h**\|\ **m**\|\ **s**\|\ 
    **c**\ *period*\ [/*phase*][**+c**\ *col*]

**-w** 选项默认将输入的 x 坐标转换为循环坐标，通过 **+c**
选项可以设置在输入中选择其他列进行转换。对于时间序列数据，可以使用由
:doc:`/module/spectrum1d` 或者 :doc:`gmt:grdfft` 提供的标准谱分析
来分析其周期。但在大多数情况下，在时域中分析周期性的各方面也是人们感兴趣的。
为了进行此类分析，我们需要将时间序列的时间坐标转换为循环的
时间坐标以便可以进行多周期堆叠，网格化以及在直方图中显示等操作。
对输入的 x，y 或者 z 坐标，转换为循环坐标遵循以下公式：

.. math::
    
    t' = (t - \tau) \;\mathrm{mod}\; T,


式中，*t* 为输入坐标，:math:`\tau` 为相移（通常为 0），*T* 为生成
循环坐标 :math:`t'` 的周期。GMT 提供了很多规定单位的标准时间循环，以及用于其他
类型的笛卡尔坐标的自定义循环。下表给出了每种循环的单位，相移以及周期，用户在使用时，
只需指定相应的代码（**y**\|\ **a**\|\ **w**\|\
**d**\|\ **h**\|\ **m**\|\ **s**\|\ **c**\ *period*\）：

+------------+---------------------------+------------+--------------+-----------+
| **代码**   | **含义** (**单位**)       | **周期**   |  **相位**    | **范围**  |
+============+===========================+============+==============+===========+
| **y**      | 年循环（归一化）          |  1 年      | 0            |   0–1     |
+------------+---------------------------+------------+--------------+-----------+
| **a**      | 年循环（月）              |  1 年      | 0            |   0–12    |
+------------+---------------------------+------------+--------------+-----------+
| **w**      | 周循环（天）              |  1 周      | 0            |   0–7     |
+------------+---------------------------+------------+--------------+-----------+
| **d**      | 天循环（小时）            |  1 天      | 0            |   0–24    |
+------------+---------------------------+------------+--------------+-----------+
| **h**      | 小时循环（分钟）          |  1 小时    | 0            |   0–60    |
+------------+---------------------------+------------+--------------+-----------+
| **m**      | 分钟循环（秒）            |  1 分      | 0            |   0–60    |
+------------+---------------------------+------------+--------------+-----------+
| **s**      | 秒循环（秒）              |  1 秒      | 0            |   0–1     |
+------------+---------------------------+------------+--------------+-----------+
| **c**      | 自定义循环（归一化）      |  :math:`T` | :math:`\tau` |   0–1     |
+------------+---------------------------+------------+--------------+-----------+

通过设置可选的子选项 **+c**\ *col* 来选择要转换的坐标 [\ *col* 的默认值为0，即第一列]。
如果选择自定义循环 **c**，则必须指定其周期，以及可选的相位 *phase* [默认为 0]，周期和
相位的单位与原始数据相同（即，**-w** 选项无需指定单位）。

**注**：

- 范围为 0-1 的 **w** 代码的起点对应于一周的第一天[星期一]，可以通过 :term:`TIME_WEEK_START` 修改
- 如果代码设置表示一个时间循环，GMT 将自动隐含地设置 **-f** 选项来表明是绝对时间（除非已经单独设置）

示例
-----

下面将通过密西西比河在 1930-1940 年期间的日流量来演示 **-w** 选项的使用。绘制日流量的时间序列：

.. gmtplot:: ./w/GMT_cycle_1.sh
    :width: 500 px
    :show-code: true

从图中可以看出日流量时间序列中含有明显的周年特征，因此可以使用归一化的年坐标来绘制日流量时间序列。
通过 **-wy** 可以将所有的年份数据都绘制在单个归一化的年份中：

.. gmtplot:: ./w/GMT_cycle_2.sh
    :width: 500 px
    :show-code: true

在上图中，常规年和闰年都按自己的长度进行了归一化。如果想从月份的角度来查看流量的变化，使同一月份
的数据都落入同样的区间中，即使区间的长度不同（28-31天）。这种情况下，可以使用 **-wa** 选项对每月
的数据进行归一化。换句话说，以三月份为例，将所有年份三月的所有数据将按三月份的长度进行归一化，然后再加 2。
这样，所有年份三月份的数据的坐标的范围为 2.00000-2.99999......，并且能很容易地制作月流量的直方图：

.. gmtplot:: ./w/GMT_cycle_3.sh
    :width: 500 px
    :show-code: true

在 :doc:`/module/histogram` 命令中使用 **-T3** 选项将能类似地获得季度的流量。从上图中可以看出，年循环（或者周循环）
轴被视为时间轴，因此可以使用与月份和工作日相关的配置参数，例如：:term:`GMT_LANGUAGE`，
:term:`FORMAT_TIME_PRIMARY_MAP` 和 :term:`TIME_WEEK_START`。

通过设置 **+c**\ *col* 子选项，**-w** 选项同样可以应用于 *y* 坐标或者任意坐标。下面，同样使用密西西比河
的数据来演示该功能，此时，将 *y* 坐标视为时间坐标。下面的脚本将会生成两个子图，每个子图都类似上文的时间
序列图，但横纵坐标相反：

.. gmtplot:: ./w/GMT_cycle_4.sh
    :width: 500 px
    :show-code: true

上图中，a) 图为归一化后一年内的密西西比河日流量，b) 图为 10 年的密西西比河月流量，以 9 月为起点。

由于 *-w* 选项为 GMT 全局选项，因此在所有可读取表数据的模块中都可以使用。因此，可以对数据进行
网格化并生成图片：

.. gmtplot:: ./w/GMT_cycle_5.sh
    :width: 500 px
    :show-code: true

上图即为使用密西西比河日流量数据生成的图片并使用默认的 cpt (turbo) 上色结果。

最后一个示例将使用 3 年的车流量数据（单位：vehicles/hour）展示周循环和日循环的使用，该车流量数据来自
连接史泰登岛和布鲁克林的韦拉札诺海峡大桥。我们将展示车流量原始时间序列，并以一周为周期，制作周流量直方图，
最终绘制小时流量直方图：

.. gmtplot:: ./w/GMT_cycle_6.sh
    :width: 500 px
    :show-code: true

a) 图为三年期间的车流量时间序列。注意到图中，Covid-19 导致了 2020 年 3 月中旬的急剧下降；其他某些时间
存在数据缺失以及 2018 年 5 月 出现一个尖峰。我们使用 **-g** 选项来避免在超过 6 小时的数据缺失画线。
b) 图为一周内车流量序列图。可以看到在工作日存在明显的早晚高峰，周末与工作日的规律不同。图 a) 中的尖峰来自某个异常的周四
和周日，这两天的数据可能有问题。
同样，使用 **-g** 选项来避免在超过 6 小时的数据缺失画线。
c) 图为一周内车流量直方图，显示了车流量在周末缓慢增加，在周末下降。脚本中对每天同一小时的数据重复计数，并绘制其平均值。
d) 图为一天内车流量直方图，使用天循环以及通过天数归一化得到。